<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daimara Delivery Services</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<style>
:root{
  --primary:rgb(233, 157, 17);
  --accent:#2563eb;
  --bg:#f4f6f9;
  --card:#ffffff;
  --text:#1f2937;
  --success:#16a34a;
  --danger:#dc2626;
  --border:#e5e7eb;
  --shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

body{
  margin:0;
  font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background:#111827;
  color:var(--text);
  line-height:1.6;
  -webkit-font-smoothing:antialiased;
}

.topbar{
  background:var(--primary);
  color:#000;
  padding:clamp(0.75rem, 2vw, 1rem) clamp(1rem, 3vw, 1.5rem);
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:sticky;
  top:0;
  z-index:100;
  box-shadow:var(--shadow);
}

.topbar h2{
  font-size:clamp(1.25rem, 4vw, 1.75rem);
  font-weight:700;
}

.topbar-actions{
  display:flex;
  gap:0.75rem;
}

.icon-btn{
  background:rgba(0,0,0,0.1);
  border:none;
  width:40px;
  height:40px;
  border-radius:50%;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.2s;
}

.icon-btn:hover{
  background:rgba(0,0,0,0.2);
  transform:scale(1.05);
}

.container{
  padding:clamp(1rem, 3vw, 2rem);
  max-width:1400px;
  margin:0 auto;
}

/* Summary Cards Grid */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(min(100%, 280px), 1fr));
  gap:clamp(1rem, 2vw, 1.5rem);
  margin-bottom:2rem;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:clamp(1.25rem, 3vw, 1.5rem);
  box-shadow:var(--shadow);
  border:1px solid var(--border);
  transition:transform 0.2s, box-shadow 0.2s;
  position:relative;
  overflow:hidden;
}

.card::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:4px;
  background:var(--primary);
}

.card:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.1);
}

.card:nth-child(2)::before{
  background:var(--accent);
}

.card:nth-child(3)::before{
  background:var(--success);
}

.card h3{
  font-size:0.875rem;
  text-transform:uppercase;
  letter-spacing:0.05em;
  color:#6b7280;
  margin-bottom:0.5rem;
  font-weight:600;
}

.card strong{
  font-size:clamp(2rem, 5vw, 2.5rem);
  color:var(--text);
  display:block;
  line-height:1.2;
}

.card .trend{
  font-size:0.875rem;
  color:#6b7280;
  margin-top:0.5rem;
  display:flex;
  align-items:center;
  gap:0.25rem;
}

/* Section Styling */
.section{
  margin-top:clamp(2rem, 5vw, 3rem);
  color:var(--text);
}

.section-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:1rem;
  flex-wrap:wrap;
  gap:1rem;
}

.section h2{
  font-size:clamp(1.25rem, 3vw, 1.5rem);
  font-weight:700;
  color:var(--text);
}

.filter-btn{
  background:white;
  border:1px solid var(--border);
  padding:0.5rem 1rem;
  border-radius:8px;
  cursor:pointer;
  font-size:0.875rem;
  display:flex;
  align-items:center;
  gap:0.5rem;
  transition:all 0.2s;
}

.filter-btn:hover{
  background:var(--bg);
  border-color:var(--primary);
}

/* Table Styles */
.table-wrapper{
  overflow-x:auto;
  border-radius:12px;
  border:1px solid var(--border);
  background:white;
  box-shadow:var(--shadow);
}

.table{
  width:100%;
  border-collapse:collapse;
  min-width:600px;
  font-size:0.95rem;
}

.table th, .table td{
  padding:1rem;
  border-bottom:1px solid var(--border);
  text-align:left;
  color:var(--text);
}

.table th{
  background:#f9fafb;
  font-weight:600;
  font-size:0.875rem;
  text-transform:uppercase;
  letter-spacing:0.025em;
  color:#374151;
  white-space:nowrap;
}

.table tbody tr{
  transition:background 0.2s;
}

.table tbody tr:hover{
  background:#f9fafb;
}

.table tbody tr:last-child td{
  border-bottom:none;
}

/* Status Badges */
.status{
  display:inline-flex;
  align-items:center;
  padding:0.375rem 0.875rem;
  border-radius:9999px;
  font-size:0.875rem;
  font-weight:500;
  gap:0.375rem;
}

.status.packed{
  background:#fef3c7;
  color:#92400e;
}

.status.out{
  background:#dbeafe;
  color:#1e40af;
}

.status.delivered{
  background:#d1fae5;
  color:#065f46;
}

.status::before{
  content:'';
  width:6px;
  height:6px;
  border-radius:50%;
  background:currentColor;
}

/* Action Buttons */
.action-btn{
  border:none;
  padding:0.625rem 1.25rem;
  border-radius:8px;
  cursor:pointer;
  color:white;
  font-weight:500;
  font-size:0.875rem;
  transition:all 0.2s;
  white-space:nowrap;
  display:inline-flex;
  align-items:center;
  gap:0.5rem;
}

.action-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}

.action-btn:active{
  transform:translateY(0);
}

.dispatch{
  background:var(--accent);
}

.dispatch:hover{
  background:#1d4ed8;
}

.delivered{
  background:var(--success);
}

.delivered:hover{
  background:#15803d;
}

/* Mobile Cards for Table Data */
.mobile-orders{
  display:none;
  flex-direction:column;
  gap:1rem;
}

.order-card{
  background:white;
  border:1px solid var(--border);
  border-radius:12px;
  padding:1.25rem;
  box-shadow:var(--shadow);
  animation:slideIn 0.3s ease-out;
}

@keyframes slideIn{
  from{
    opacity:0;
    transform:translateY(10px);
  }
  to{
    opacity:1;
    transform:translateY(0);
  }
}

.order-header{
  display:flex;
  justify-content:space-between;
  align-items:start;
  margin-bottom:1rem;
  padding-bottom:1rem;
  border-bottom:1px solid var(--border);
}

.order-id{
  font-weight:700;
  font-size:1.125rem;
  color:var(--text);
}

.order-details{
  display:grid;
  gap:0.75rem;
  margin-bottom:1rem;
}

.detail-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.detail-label{
  font-size:0.875rem;
  color:#6b7280;
  font-weight:500;
}

.detail-value{
  font-weight:600;
  color:var(--text);
}

.order-actions{
  display:flex;
  gap:0.75rem;
}

.order-actions .action-btn{
  flex:1;
  justify-content:center;
  padding:0.875rem;
}

/* QR Scanner Section */
.scanner-section{
  margin-top:clamp(2rem, 5vw, 3rem);
  background:white;
  border-radius:16px;
  padding:clamp(1.5rem, 4vw, 2rem);
  border:1px solid var(--border);
  box-shadow:var(--shadow);
}

.scanner-header{
  margin-bottom:1.5rem;
}

.scanner-header h2{
  font-size:clamp(1.25rem, 3vw, 1.5rem);
  margin-bottom:0.5rem;
}

.scanner-header p{
  color:#6b7280;
  font-size:1rem;
}

.scanner-container{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:1.5rem;
}

#reader{
  width:100%;
  max-width:500px;
  border-radius:12px;
  overflow:hidden;
  border:2px solid var(--border);
}

/* Custom QR Scanner Styling */
#reader__dashboard_section_csr span{
  color:var(--text) !important;
  font-family:inherit !important;
}

#reader__camera_permission_button,
#reader__dashboard_section_swaplink{
  background:var(--primary) !important;
  color:black !important;
  padding:0.75rem 1.5rem !important;
  border-radius:8px !important;
  text-decoration:none !important;
  font-weight:600 !important;
  display:inline-block !important;
  margin:0.5rem !important;
}

.scan-result{
  margin-top:1rem;
  padding:1rem 1.5rem;
  border-radius:12px;
  font-weight:600;
  text-align:center;
  width:100%;
  max-width:500px;
  transition:all 0.3s;
}

.scan-result.waiting{
  background:#f3f4f6;
  color:#6b7280;
  border:2px dashed var(--border);
}

.scan-result.success{
  background:#d1fae5;
  color:#065f46;
  border:2px solid var(--success);
  animation:pulse 2s infinite;
}

@keyframes pulse{
  0%, 100%{
    box-shadow:0 0 0 0 rgba(22, 163, 74, 0.4);
  }
  50%{
    box-shadow:0 0 0 10px rgba(22, 163, 74, 0);
  }
}

/* Empty State */
.empty-state{
  text-align:center;
  padding:3rem 1rem;
  color:#6b7280;
}

.empty-state i{
  font-size:3rem;
  margin-bottom:1rem;
  opacity:0.3;
}

/* Responsive Breakpoints */
@media (max-width:768px){
  .table-wrapper{
    display:none;
  }
  
  .mobile-orders{
    display:flex;
  }
  
  .section-header{
    flex-direction:column;
    align-items:stretch;
  }
  
  .filter-btn{
    justify-content:center;
  }
  
  .order-actions{
    flex-direction:column;
  }
  
  .order-actions .action-btn{
    width:100%;
  }
  
  #reader{
    max-width:100%;
  }
}

@media (min-width:769px){
  .mobile-orders{
    display:none !important;
  }
}

/* Touch optimizations */
@media (hover:none) and (pointer:coarse){
  .action-btn,
  .filter-btn,
  .icon-btn{
    min-height:44px;
  }
  
  .card{
    transform:none !important;
  }
}

/* Dark mode support */
@media (prefers-color-scheme:dark){
  :root{
    --bg:#111827;
    --card:#1f2937;
    --text:#f9fafb;
    --border:#374151;
  }
  
  .table th{
    background:#374151;
    color:#e5e7eb;
  }
  
  .table tbody tr:hover{
    background:#374151;
  }
  
  .status.packed{
    background:#451a03;
    color:#fcd34d;
  }
  
  .status.out{
    background:#1e3a8a;
    color:#93c5fd;
  }
  
  .scan-result.waiting{
    background:#374151;
    color:#9ca3af;
    border-color:#4b5563;
  }
}

/* Print styles */
@media print{
  .topbar,
  .action-btn,
  .scanner-section,
  .filter-btn{
    display:none !important;
  }
  
  .card{
    break-inside:avoid;
    box-shadow:none;
    border:1px solid #000;
  }
  
  .table-wrapper{
    overflow:visible;
  }
}

/* Loading state */
.loading{
  opacity:0.6;
  pointer-events:none;
}

/* Accessibility */
@media (prefers-reduced-motion:reduce){
  *{
    animation-duration:0.01ms !important;
    animation-iteration-count:1 !important;
    transition-duration:0.01ms !important;
  }
}

.sr-only{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  white-space:nowrap;
  border-width:0;
}
</style>
<base target="_blank">
</head>
<body>

<div class="topbar">
  <h2><i class="fas fa-truck-fast"></i> Daimara Delivery</h2>
  <div class="topbar-actions">
    <button class="icon-btn" aria-label="Notifications">
      <i class="fas fa-bell"></i>
    </button>
    <button class="icon-btn" aria-label="Profile">
      <i class="fas fa-user"></i>
    </button>
  </div>
</div>

<div class="container">

  <!-- SUMMARY CARDS -->
  <div class="grid">
    <div class="card">
      <h3>Orders Ready for Dispatch</h3>
      <strong id="readyCount">22</strong>
      <div class="trend">
        <i class="fas fa-arrow-up" style="color:var(--success)"></i>
        <span>12% from yesterday</span>
      </div>
    </div>
    <div class="card">
      <h3>Out for Delivery</h3>
      <strong id="outCount">15</strong>
      <div class="trend">
        <i class="fas fa-minus" style="color:var(--accent)"></i>
        <span>Same as yesterday</span>
      </div>
    </div>
    <div class="card">
      <h3>Delivered Today</h3>
      <strong id="deliveredCount">31</strong>
      <div class="trend">
        <i class="fas fa-arrow-up" style="color:var(--success)"></i>
        <span>8% from yesterday</span>
      </div>
    </div>
  </div>

  <!-- DISPATCH LIST -->
  <div class="section">
    <div class="section-header">
      <h2><i class="fas fa-box-open"></i> Dispatch Packed Orders</h2>
      <button class="filter-btn">
        <i class="fas fa-filter"></i> Filter Orders
      </button>
    </div>
    
    <!-- Desktop Table -->
    <div class="table-wrapper">
      <table class="table" id="ordersTable">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Client</th>
            <th>Destination</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- Populated by JS -->
        </tbody>
      </table>
    </div>
    
    <!-- Mobile Cards -->
    <div class="mobile-orders" id="mobileOrders">
      <!-- Populated by JS -->
    </div>
    
    <!-- Empty State -->
    <div class="empty-state" id="emptyState" style="display:none;">
      <i class="fas fa-inbox"></i>
      <h3>No Orders Found</h3>
      <p>All orders have been processed</p>
    </div>
  </div>

  <!-- QR CODE SCANNER -->
  <div class="scanner-section">
    <div class="scanner-header">
      <h2><i class="fas fa-qrcode"></i> Scan Client Receipt</h2>
      <p>Scan the client's receipt QR code to confirm delivery instantly</p>
    </div>
    <div class="scanner-container">
      <div id="reader"></div>
      <div class="scan-result waiting" id="result">
        <i class="fas fa-camera"></i> Waiting for scan...
      </div>
    </div>
  </div>

</div>

<script>
// Sample data - in real app, this would come from localStorage or API
let orders = [
  {id: '#DM2042', client: 'Peter Otieno', destination: 'Karen', status: 'Packed'},
  {id: '#DM2043', client: 'Grace Njeri', destination: 'Kilimani', status: 'Out for Delivery'},
  {id: '#DM2044', client: 'John Kamau', destination: 'Westlands', status: 'Packed'},
  {id: '#DM2045', client: 'Mary Wanjiku', destination: 'Ngong Road', status: 'Out for Delivery'},
];

function renderOrders(){
  const tableBody = document.getElementById('tableBody');
  const mobileContainer = document.getElementById('mobileOrders');
  const emptyState = document.getElementById('emptyState');
  
  tableBody.innerHTML = '';
  mobileContainer.innerHTML = '';
  
  if(orders.length === 0){
    emptyState.style.display = 'block';
    return;
  } else {
    emptyState.style.display = 'none';
  }
  
  orders.forEach((order, index) => {
    const isPacked = order.status === 'Packed';
    const statusClass = isPacked ? 'packed' : 'out';
    const statusText = isPacked ? 'Packed' : 'Out for Delivery';
    const btnClass = isPacked ? 'dispatch' : 'delivered';
    const btnText = isPacked ? 'Send to Delivery' : 'Mark Delivered';
    const btnIcon = isPacked ? 'fa-paper-plane' : 'fa-check';
    
    // Desktop Table Row
    tableBody.innerHTML += `
      <tr>
        <td><strong>${order.id}</strong></td>
        <td>${order.client}</td>
        <td>${order.destination}</td>
        <td><span class="status ${statusClass}">${statusText}</span></td>
        <td>
          <button class="action-btn ${btnClass}" onclick="updateStatus(${index})">
            <i class="fas ${btnIcon}"></i> ${btnText}
          </button>
        </td>
      </tr>
    `;
    
    // Mobile Card
    mobileContainer.innerHTML += `
      <div class="order-card">
        <div class="order-header">
          <span class="order-id">${order.id}</span>
          <span class="status ${statusClass}">${statusText}</span>
        </div>
        <div class="order-details">
          <div class="detail-row">
            <span class="detail-label">Client</span>
            <span class="detail-value">${order.client}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Destination</span>
            <span class="detail-value">${order.destination}</span>
          </div>
        </div>
        <div class="order-actions">
          <button class="action-btn ${btnClass}" onclick="updateStatus(${index})">
            <i class="fas ${btnIcon}"></i> ${btnText}
          </button>
        </div>
      </div>
    `;
  });
  
  updateCounts();
}

function updateStatus(index){
  const order = orders[index];
  if(order.status === 'Packed'){
    order.status = 'Out for Delivery';
  } else if(order.status === 'Out for Delivery'){
    order.status = 'Delivered';
    // Remove from active list after delivery
    setTimeout(() => {
      orders.splice(index, 1);
      renderOrders();
    }, 500);
  }
  renderOrders();
}

function updateCounts(){
  const ready = orders.filter(o => o.status === 'Packed').length;
  const out = orders.filter(o => o.status === 'Out for Delivery').length;
  const delivered = 31; // This would be calculated from actual data
  
  document.getElementById('readyCount').textContent = ready;
  document.getElementById('outCount').textContent = out;
  document.getElementById('deliveredCount').textContent = delivered;
}

// QR Scanner
function onScanSuccess(decodedText) {
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = `<i class="fas fa-check-circle"></i> Delivery Confirmed: ${decodedText}`;
  resultDiv.className = "scan-result success";
  
  // Play success sound (optional)
  // new Audio('success.mp3').play().catch(e => console.log('Audio play failed'));
  
  // Reset after 5 seconds
  setTimeout(() => {
    resultDiv.innerHTML = '<i class="fas fa-camera"></i> Waiting for scan...';
    resultDiv.className = "scan-result waiting";
  }, 5000);
}

function onScanError(error) {
  // Only log warnings, don't show to user to avoid spam
  console.warn(error);
}

// Initialize QR Scanner
let html5QrcodeScanner;
try {
  html5QrcodeScanner = new Html5QrcodeScanner(
    "reader", { 
      fps: 10, 
      qrbox: { width: 250, height: 250 },
      aspectRatio: 1.0
    }
  );
  html5QrcodeScanner.render(onScanSuccess, onScanError);
} catch(e) {
  console.error("QR Scanner initialization failed:", e);
  document.getElementById("result").innerHTML = 
    '<i class="fas fa-exclamation-triangle"></i> Camera access required for scanning';
  document.getElementById("result").className = "scan-result";
  document.getElementById("result").style.background = "#fee2e2";
  document.getElementById("result").style.color = "#991b1b";
}

// Initialize
renderOrders();

// Simulate real-time updates (optional)
setInterval(() => {
  // In a real app, this would fetch new data
  // renderOrders();
}, 30000);
</script>

</body>
</html>