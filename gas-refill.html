<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gas Refilling</title>
<meta name="viewport" content="width=1200">

<style>
body{font-family:Arial;background:#f5f5f5;padding:20px;padding-top: 160px; font-size: 25px; padding-bottom: 100px;}

/* FOOTER */
.footer {
  background: #0a0a0a;
  color: white;
  padding: 30px 20px;
  text-align: center;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
}
.footer p {
  color: rgb(233, 157, 17);
}

/* NAVBAR */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: #111;
  color: #fff;
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 1000;
}
.logo { color: #e99d11; font-weight: bold; text-decoration: none; font-size: 18px; }
.nav-links a { color: #fff; text-decoration: none; margin-left: 15px; font-size: 14px; }
@media (max-width: 768px) {
  .nav-links a { font-size: 18px; }
}
 .search-container {
  position: fixed;
  top: 65px;
  left: -28px;
  width: 450px;
  margin: 0 0 0 30px;
  z-index: 1001;
}

#search-input {
  width: 100%;
  padding: 10px;
  border: none;
  background-color:#0000009a ;
  border-radius: 5px;
   font-size: 18px;
}

#search-input::placeholder {
  color: #000000;
  opacity: 1;
}

#search-btn {
  position: absolute;
  right: 10px;
  top: 14px;
  background: none;
  border: none;
  cursor: pointer;
}

#search-results {
  position: absolute;
  top: 45px;
  width: 100%;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 5px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  display: none;
  z-index: 1001;
  max-height: 300px;
  overflow-y: auto;
  left: 0;
}

#search-results div {
  padding: 10px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  color: #333;
  transition: 0.2s;
  background-color: #f9f9f9;
}

#search-results div:hover {
  background: #000000;
  color: #ffffff;
}

#search-results strong {
  color: #1d1c1c;
}


.container{max-width:900px;margin:auto;background:#fff;padding:25px;border-radius:10px}
h2{text-align:center;color:#e99d11}
.sizes{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
.card{border:1px solid #ddd;border-radius:10px;padding:15px;text-align:center}
.card img{width:100%;height:150px;object-fit:cover;border-radius:8px}
.card button{background:#111;color:#e99d11;border:none;padding:8px 15px;border-radius:5px}
label{display:block;margin-top:15px}
#qty{width:100%;padding:10px}
button.order{width:100%;margin-top:20px;padding:12px;background:#111;color:#e99d11;border:none;border-radius:5px}
</style>
</head>

<body>

<nav class="navbar">
  <a href="home.html" class="logo">Daimara Online Mart</a>
  <div class="nav-links">
    <a href="Shop.html">Shop</a>
  </div>
</nav>

<footer class="footer">
  <p>Copyright Â© 2026 Daimara Online Mart.All rights reserved.</p>
</footer>

<div class="search-container">
  <input type="text" id="search-input" placeholder="Search products...">
  <div id="search-results"></div>
</div>

<div class="container">
<h2>Gas Refilling</h2>

<div class="sizes" id="gas-products-container">
  <!-- Dynamic content from DataManager -->
</div>

<label>Selected Gas Size</label>
<input id="gasSize" readonly>

<label>Quantity</label>
<input type="number" id="qty" value="1" min="1">

<button class="order" onclick="placeGasOrder()">Add to Cart</button>
</div>

<script src="data-manager.js"></script>
<script src="auth-check.js"></script>
<script>
let selectedGas = null;

// Render Gas Products
function renderGasProducts() {
  const container = document.getElementById('gas-products-container');
  const allProducts = DataManager.getAllProducts();
  const gasProducts = allProducts['Gas'] || [];

  if (gasProducts.length === 0) {
    container.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No gas products available.</p>';
    return;
  }

  container.innerHTML = gasProducts.map(p => `
    <div class="card">
      <img src="${p.image || 'https://picsum.photos/300/200?gas'}">
      <h3>${p.name}</h3>
      <p>${p.description || 'Gas refill service'}</p>
      <p><strong>Price: KSh ${p.price}</strong></p>
      <button onclick="selectGasById('${p.id}')">Select</button>
    </div>
  `).join('');
}

// Select gas
function selectGasById(id){
  const allProducts = DataManager.getAllProducts();
  const gasProducts = allProducts['Gas'] || [];
  const product = gasProducts.find(p => p.id === id);
  if(!product) return;

  document.getElementById("gasSize").value = product.name;
  selectedGas = { ...product };
  
  // Ensure product is in warehouse for admin to see
  DataManager.addToWarehouse(selectedGas, 1);
}

// Select gas (legacy support)
function selectGas(size, price, image){
  document.getElementById("gasSize").value = size;
  selectedGas = {
    id: "gas-" + size.replace(/\s+/g, '-').toLowerCase(),
    name: "Gas Refill (" + size + ")",
    size,
    price,
    image,
    subcategory: 'Gas'
  };
  
  // Ensure product is in warehouse for admin to see
  DataManager.addToWarehouse(selectedGas, 1);
}

// Initialize
renderGasProducts();

// Place order
function placeGasOrder(){
  if(!selectedGas){
    alert("Please select gas size");
    return;
  }

  const quantity = parseInt(document.getElementById("qty").value) || 1;
  
  // Use DataManager
  for(let i=0; i<quantity; i++) {
    DataManager.addToCart({
      ...selectedGas
    });
  }

  alert("Added to cart!");
  window.location.href = "cart.html";
}

// Search functionality
(function() {
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  function getAllFlattened(){
    const all = DataManager.getAllProducts();
    return Object.keys(all).reduce((acc,k)=> acc.concat(all[k]||[]), []);
  }

  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim().toLowerCase();
    if (!query) {
      searchResults.style.display = 'none';
      return;
    }

    const all = getAllFlattened();
    const results = all.filter(p => p.name.toLowerCase().includes(query));

    if (results.length > 0) {
      searchResults.innerHTML = results.map(p => {
        let url = 'Shop.html?search=' + encodeURIComponent(p.name);
        if (p.subcategory === 'Gas') url = 'gas-refill.html';
        if (p.subcategory === 'Water') url = 'water-refill.html';
        
        return `
          <div onclick="window.location.href='${url}'">
            <strong>${p.name}</strong><br>
            <span style="font-size: 12px; color: #666;">Ksh ${p.price}</span>
          </div>
        `;
      }).join('');
      searchResults.style.display = 'block';
    } else {
      searchResults.innerHTML = '<div style="padding: 10px;">No results</div>';
      searchResults.style.display = 'block';
    }
  });

  document.addEventListener('click', (e) => {
    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
      searchResults.style.display = 'none';
    }
  });
})();
</script>

</body>
</html>
