
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Daimara Online Mart | Cart</title>
    <link rel="stylesheet" href="cart.css">
    <meta name="viewport" content="width=1200">
    <style>* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: Arial, sans-serif;
  background-color: #f5f5f5;
  font-size: 25px;
  padding-bottom: 100px;
  
}

/* FOOTER */
.footer {
  background: #0a0a0a;
  color: white;
  padding: 30px 20px;
  text-align: center;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
}
.footer p {
  color: rgb(233, 157, 17);
}

/* PARA */
.para{
 color: #f5f5f5;
}

.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #000000;
  padding: 15px 30px;
  color: white;
   position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: #000000; /* Add your desired background color */
    z-index: 1000; /* Ensure it's on top of other elements */ 
}

.nav-left {
  font-size: 18px;
  font-weight: bold;
  color: rgb(233, 157, 17);
  font-size:25px;
}

.nav-right a {
  color: white;
  text-decoration: none;
  margin-left: 20px;
  transition: color 0.3s;
   font-size: 25px;
}

.nav-right a:hover,
.nav-right a.active {
  color: rgb(233, 157, 17);
}

@media (max-width: 768px) {
  .nav-right a { font-size: 25px; }
  .nav-cart a { font-size: 25px; }
}

/* Nav Profile Icon Container */
.nav-profile-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Nav Login Container */
.nav-login {
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Nav Cart Container */
.nav-cart {
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.cart-container {
  max-width: 1000px;
  min-height: 550px;
  height: auto;
  margin: 100px auto 30px auto;
  padding: 50px 100px;
  border-radius: 8px;
  background-color: #f5f5f5;
}

h4 {
  text-align: center;
  font-family: Arial, sans-serif;
  margin-bottom: 20px;
  color: #000000;
  font-weight: bold;
  font-size: 35px;

}

#cart-items {
  margin-bottom: 20px;
  min-height: 100px;
  max-height: 600px;
  overflow-y: auto;
  padding-right: 10px;
  font-size: 30;
}

#cart-items p {
  padding: 10px;
  border-bottom: 1px solid #ecf0f1;
  color: #000000;
  font-weight: 500;
  font-size: 30px;
}

#cart-items p a {
  color: #000000;
  text-decoration: none;
  font-size: 30px;
}

#cart-items p a:hover {
  text-decoration: underline;
}

/* Cart Item Card Styles */
.cart-item-card {
  display: grid;
  grid-template-columns: 120px 1fr 150px;
  gap: 15px;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin-bottom: 15px;
  background-color: #f9f9f9;
  align-items: start;
}

.cart-item-image {
  overflow: hidden;
  border-radius: 5px;
  background-color: white;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cart-item-image img {
  width: 100%;
  height: 120px;
  object-fit: cover;
}

.cart-item-details h3 {
  margin: 0 0 8px 0;
  color: #000000;
  font-size: 30px;
}

.cart-item-details .description {
  font-size: 30px;
  color: #fdfdfd;
  margin: 5px 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.cart-item-details .price {
  font-weight: bold;
  color: #e74c3c;
  font-size: 30px;
  margin: 8px 0;
}

.quantity-control {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 8px;
}

.qty-btn {
  width: 30px;
  height: 30px;
  border: 1px solid #bdc3c7;
  background-color: white;
  cursor: pointer;
  border-radius: 4px;
  font-weight: bold;
  color: #000000;
  transition: background-color 0.3s;
  font-size: 33px;
}

.qty-btn:hover {
  background-color: #ecf0f1;
}

.qty-display {
  min-width: 30px;
  text-align: center;
  font-weight: bold;
  color: #000000;
  font-size: 33px;
}

.cart-item-action {
  text-align: right;
  display: flex;
  flex-direction: column;
  gap: 10px;
  font-size: 30px;
}

.subtotal {
  font-weight: bold;
  color: #27ae60;
  font-size: 30px;
  margin: 0;
}

.remove-btn {
  padding: 8px 12px;
  background-color: #000000;
  color: rgb(204, 14, 14);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 30px;
  transition: 0.3s;
}

.remove-btn:hover {
  background-color: #c0392b;
  color: #ecf0f1;
}

.cart-total {
  margin-top: 20px;
  font-weight: bold;
  text-align: right;
  padding: 15px;
  background-color: #ecf0f1;
  border-radius: 5px;
  font-size: 32px;
  color: #000000;
}

.checkout {
  display: flex;
  gap: 10px;
  margin-top: 20px;
  flex-wrap: wrap;
}

.checkout a {
  flex: 1;
  display: block;
  text-align: center;
  padding: 12px;
  background-color: #000000;
  color: rgb(233, 157, 17);
  text-decoration: none;
  border-radius: 5px;
  border: none;
  transition: background-color 0.3s;
  font-weight: bold;
  cursor: pointer;
}

.checkout a:hover {
  background-color: #000000;
  color: white;
}



/* Login Button */
#login-btn {
  color: white;
  text-decoration: none;
  font-size: 14px;
  padding: 8px 12px;
  border-radius: 8px;
  transition: all 0.3s ease;
  display: none;
}

#login-btn:hover {
  color: rgb(233, 157, 17);
}

/* Profile Dropdown */
#profile-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(233, 157, 17, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

#profile-icon img {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
}

#dropdown-menu {
  display: none;
  position: absolute;
  top: 70px;
  right: 20px;
  background: #1a1a1a;
  border: 2px solid rgb(233, 157, 17);
  border-radius: 10px;
  padding: 10px 0;
  min-width: 180px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
  z-index: 2000;
}

#dropdown-menu.show {
  display: block;
}

#dropdown-menu a,
#dropdown-menu button {
  display: block;
  width: 100%;
  padding: 12px 20px;
  color: #ecf0f1;
  text-decoration: none;
  border: none;
  background: transparent;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 14px;
  text-align: left;
}

#dropdown-menu a:hover,
#dropdown-menu button:hover {
  background: rgba(233, 157, 17, 0.2);
  color: rgb(233, 157, 17);
  padding-left: 25px;
}

#dropdown-menu button {
  color: #e74c3c;
  font-weight: 600;
}

#dropdown-menu button:hover {
  background: rgba(231, 76, 60, 0.2);
  color: #ff6b6b;
}/* SLIDER */
.slider {
  position: relative;
  width: 100%;
  height: 400px;
  overflow: hidden;
  margin-top: 30px;
}
.slide {
  display: none;
}
.slide img {
  width: 100%;
  height: 400px;
  object-fit: cover;
}

/* RANDOM PRODUCTS */
.products-preview {
  padding: 40px 30px;
  max-width: 1200px;
  margin: 0 auto;
}
.products-preview h2 {
  color: rgb(233, 157, 17);
  text-align: center;
  margin-bottom: 25px;
  font-size: 35px;
}
#random-products {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 20px;
}
.product {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, .1);
  text-align: center;
}
.product img {
  width: 100%;
  height: 160px;
  object-fit: cover;
  border-radius: 8px;
}
.product h4 {
  font-size: 24px;
  margin: 10px 0;
  text-align: center;
}
.product p {
  font-size: 22px;
  color: #000000;
  font-weight: bold;
}
.product button {
  margin-top: 10px;
  padding: 8px 15px;
  border: none;
  border-radius: 5px;
  background: #111;
  color: rgb(233, 157, 17);
  cursor: pointer;
  font-size: 20px;
}
</style>
</head>
<body>


    <nav class="navbar">
        <div class="nav-left">
           <!-- <a href="index.html" style="text-decoration: none; color: inherit;"><span>Cart</span></a>-->
        </div>
        <div class="nav-right" style="display: flex; gap: 15px; align-items: center;">
            <!--<div class="nav-profile-icon">
              <a id="profile-icon" href="profile.html" title="Profile" style="text-decoration: none; color: inherit;">
                <span style="font-size: 20px; color: rgb(233, 157, 17);">ðŸ‘¤</span>
              </a>
            </div>-->
            <div class="nav-login">
              <a id="login-btn" href="login.html">Login</a>
            </div>
            <div class="nav-cart">
              <a href="supermarket.html">supermarket</a>
              <a href="second-hand items.html">second-hand items</a>
            </div>
        </div>
    </nav>

<footer class="footer">
  <p>Copyright Â© 2026 Daimara Online Mart.All rights reserved.</p>
</footer>

    <div class="cart-container">
        <h4>Your Cart</h4>

        <div id="cart-items">
            <!-- Cart items injected by JS -->
        </div>

        <div class="cart-total">
            <p>Total: Ksh <span id="total">0</span></p>
        </div>

        <nav class="checkout">
            <a href="checkout.html" id="checkout">Checkout</a>
            <a href="store.html">Continue Shopping</a>
        </nav>
    </div>

    <!-- SLIDESHOW -->
    <div class="slider">
        <div class="slide"><img src="https://picsum.photos/1200/400?1"></div>
        <div class="slide"><img src="https://picsum.photos/1200/400?2"></div>
        <div class="slide"><img src="https://picsum.photos/1200/400?3"></div>
    </div>

    <!-- RANDOM PRODUCTS -->
    <section class="products-preview">
        <h2>Recommended for You</h2>
        <div id="random-products"></div>
    </section>
    
    <script src="data-manager.js"></script>
    <script src="auth-check.js"></script>
    <script>
  // Get cart from DataManager
  let cart = DataManager.getCart();
  let listenersAttached = false;

function renderCart() {
  const cartItems = document.getElementById('cart-items');
  cartItems.innerHTML = '';

  if (cart.length === 0) {
    cartItems.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">Your cart is empty. <a href="store.html">Continue shopping</a></p>';
    document.getElementById('total').textContent = '0';
    return;
  }

  let total = 0;

  cart.forEach((item, index) => {
    const subtotal = item.price * (item.qty || 1);
    total += subtotal;

    const cartItem = document.createElement('div');
    cartItem.className = 'cart-item-card';
    cartItem.setAttribute('data-product-id', item.id);
    
    const imageSrc = item.image || 'image-placeholder.jpg';
    
    cartItem.innerHTML = `
      <div class="cart-item-image">
        <img src="${imageSrc}" alt="${item.name}">
      </div>
      <div class="cart-item-details">
        <h3>${item.name}</h3>
        <p class="description">${item.description || 'No description available'}</p>
        ${item.location ? `<p style="font-size: 11px; color: #666;">Location: ${item.location.lat.toFixed(4)}, ${item.location.lng.toFixed(4)}</p>` : ''}
        <p class="price">Ksh ${item.price.toLocaleString()}</p>
        <div class="quantity-control">
          <button class="qty-btn decrease-btn">-</button>
          <span class="qty-display">${item.qty || 1}</span>
          <button class="qty-btn increase-btn">+</button>
        </div>
      </div>
      <div class="cart-item-action">
        <p class="subtotal">Ksh ${subtotal.toLocaleString()}</p>
        <button class="remove-btn">Remove</button>
      </div>
    `;
    
    cartItems.appendChild(cartItem);
  });

  document.getElementById('total').textContent = total.toLocaleString();
  setupCartEventListeners();
}

function setupCartEventListeners() {
  if (listenersAttached) return;
  const cartItems = document.getElementById('cart-items');

  cartItems.addEventListener('click', function(e) {
    const card = e.target.closest('.cart-item-card');
    if (!card) return;
    const productId = card.getAttribute('data-product-id');
    if (e.target.classList.contains('increase-btn')) {
      increaseQty(productId);
    } else if (e.target.classList.contains('decrease-btn')) {
      decreaseQty(productId);
    } else if (e.target.classList.contains('remove-btn')) {
      removeFromCart(productId);
    }
  });
  listenersAttached = true;
}

function increaseQty(productId) {
  const currentItem = DataManager.getCart().find(i => i.id === productId);
  if (!currentItem) {
    console.error("Product not found in cart:", productId);
    alert('Error: Product not found in cart');
    return;
  }
  const newQty = (currentItem.qty || 1) + 1;
  const result = DataManager.updateCartQuantity(productId, newQty);
  if (result && result.success) {
    cart = DataManager.getCart();
    renderCart();
  } else {
    console.error("Failed to increase quantity", result);
    alert('Error updating quantity');
  }
}

function decreaseQty(productId) {
  const item = DataManager.getCart().find(i => i.id === productId);
  if (!item) {
    console.error("Product not found in cart:", productId);
    alert('Error: Product not found in cart');
    return;
  }
  if (item.qty > 1) {
    const result = DataManager.updateCartQuantity(productId, item.qty - 1);
    if (result && result.success) {
      cart = DataManager.getCart();
      renderCart();
    } else {
      console.error("Failed to decrease quantity", result);
      alert('Error updating quantity');
    }
  } else {
    console.log("Cannot decrease quantity below 1");
  }
}

function removeFromCart(productId) {
  const result = DataManager.removeFromCart(productId);
  if (result && result.success) {
    cart = DataManager.getCart();
    renderCart();
  } else {
    console.error("Failed to remove from cart", result);
    alert('Error removing item from cart');
  }
}

document.getElementById('checkout').addEventListener('click', function (event) {
  if (cart.length === 0) {
    event.preventDefault();
    alert('Cart is empty!');
  } else {
    const user = DataManager.getCurrentUser();
    if (!user) {
      alert('Please login to proceed to checkout');
      window.location.href = 'login.html';
    } else {
      window.location.href = 'checkout.html';
    }
  }
});

// Refresh cart when page becomes visible
document.addEventListener('visibilitychange', function() {
  if (document.visibilityState === 'visible') {
    cart = DataManager.getCart();
    renderCart();
  }
});

// Refresh cart when window regains focus
window.addEventListener('focus', function() {
  cart = DataManager.getCart();
  renderCart();
});

// SLIDER
let sliderIndex = 0;
const slides = document.querySelectorAll('.slide');
function showSlides() {
  slides.forEach(s => s.style.display = 'none');
  sliderIndex = (sliderIndex + 1) > slides.length ? 1 : sliderIndex + 1;
  if (slides[sliderIndex - 1]) slides[sliderIndex - 1].style.display = 'block';
  setTimeout(showSlides, 3000);
}
showSlides();

// RANDOM PRODUCTS
(function() {
  const rndContainer = document.getElementById('random-products');
  function getAllFlattened() {
    const all = DataManager.getAllProducts();
    return Object.keys(all).reduce((acc, k) => acc.concat(all[k] || []), []);
  }

  window.addToCartById = function(id) {
    const prod = getAllFlattened().find(p => p.id === id);
    if (!prod) { alert('Product not found'); return; }
    DataManager.addToCart(prod);
    cart = DataManager.getCart();
    renderCart();
    alert('Added to cart');
  };

  function renderRandom(n = 8) {
    if (!rndContainer) return;
    const all = getAllFlattened();
    if (all.length === 0) { rndContainer.innerHTML = '<p>No products available yet.</p>'; return; }
    const shuffled = all.slice().sort(() => 0.5 - Math.random()).slice(0, n);
    rndContainer.innerHTML = '';
    shuffled.forEach(p => {
      const img = p.image || 'https://picsum.photos/300/200';
      rndContainer.innerHTML += `
        <div class="product">
          <img src="${img}">
          <h4>${p.name}</h4>
          <p>Ksh ${p.price}</p>
          <button onclick="addToCartById('${p.id}')">Add to Cart</button>
        </div>`;
    });
  }
  renderRandom(8);
})();

renderCart();



</script>
</body>
</html>




